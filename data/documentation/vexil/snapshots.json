{"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","level":2,"type":"heading","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Snapshots are one of the most versatile features of Vexil. They are used to support "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPublishing"},{"type":"text","text":" using Combine and provide the primary source of mutability to a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole"},{"type":"text","text":"."}]},{"anchor":"Mutating-the-FlagPole","level":2,"type":"heading","text":"Mutating the FlagPole"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Having the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole"},{"type":"text","text":" be immutable directly was a deliberate design decision. It prevents a category of programming mistakes (eg. "},{"type":"codeVoice","code":"flagPole.myFlag = true"},{"type":"text","text":"), but it also keeps the API simple and easy to reason about."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"That said - mutating the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole"},{"type":"text","text":" is still very straight forward as each "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/Snapshot"},{"type":"text","text":" also conforms to "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagValueSource"},{"type":"text","text":" - that means it can be added into your "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole"},{"type":"text","text":"’s source hierarchy in any position:"}]},{"type":"codeListing","syntax":"swift","code":["let flagPole = FlagPole(hoist: MyFlags.self)","","\/\/ create an empty Snapshot and change the values we want","let snapshot = flagPole.emptySnapshot()","snapshot.subgroup.myBooleanFlag = true","","\/\/ insert that snapshot at the top of the hierarchy so it overrides all the rest","flagPole.insert(snapshot: snapshot, at: 0)"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The source hierarchy is also accessible via "},{"type":"codeVoice","code":"FlagPole._sources"},{"type":"text","text":" if you want to manipulate it directly."}]},{"anchor":"Mutating-a-FlagValueSource","level":2,"type":"heading","text":"Mutating a FlagValueSource"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Snapshot"},{"type":"text","text":"s also provide a way to modify a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagValueSource"},{"type":"text","text":", so you could use it whenever you need to update the "},{"type":"codeVoice","code":"UserDefaults"},{"type":"text","text":", for example. This is the same capability Vexillographer uses to provide its flag editing user interface."}]},{"type":"codeListing","syntax":"swift","code":["let flagPole = FlagPole(hoist: MyFlags.self)","","\/\/ create an empty Snapshot and change the values we want","let snapshot = flagPole.emptySnapshot()","snapshot.subgroup.myBooleanFlag = true","","\/\/ save that to the UserDefaults","try flagPole.save(snapshot: snapshot, to: UserDefaults.standard)"]},{"anchor":"How-snapshots-work","level":2,"type":"heading","text":"How snapshots work"},{"type":"paragraph","inlineContent":[{"type":"text","text":"You can think of "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/Snapshot"},{"type":"text","text":"s as a simple mutable dictionary of flag values. It is literally a "},{"type":"codeVoice","code":"[String: Any]"},{"type":"text","text":" where the string key corresponds to the flag’s key, and the value is the Flag’s value. It then uses the same logic as a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole"},{"type":"text","text":" in routing requests for the flag’s value to the internal dictionary."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This follows the design philosophy in Vexil that a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagValueSource"},{"type":"text","text":" should only return a value if it has been explicitly set in that source, and should otherwise return "},{"type":"codeVoice","code":"nil"},{"type":"text","text":" to allow the next "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagValueSource"},{"type":"text","text":" to be consulted."}]},{"anchor":"Creating-snapshots","level":2,"type":"heading","text":"Creating snapshots"},{"type":"paragraph","inlineContent":[{"type":"text","text":"There are two ways to create a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/Snapshot"},{"type":"text","text":", empty or full."}]},{"anchor":"Empty-snapshots","level":3,"type":"heading","text":"Empty snapshots"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When taking an empty snapshot, its internal dictionary is also empty, and the request for the Flag’s value (when used as a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagValueSource"},{"type":"text","text":") will be "},{"type":"codeVoice","code":"nil"},{"type":"text","text":". If you access the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/Flag\/wrappedValue"},{"type":"text","text":" property directly (eg. "},{"type":"codeVoice","code":"flagPole.subgroup.myBooleanFlag"},{"type":"text","text":") it will return the flag’s "},{"type":"strong","inlineContent":[{"type":"text","text":"default value"}]},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Empty snapshots are typically used for mutating the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole"},{"type":"text","text":" or a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagValueSource"},{"type":"text","text":"."}]},{"type":"codeListing","syntax":"swift","code":["let flagPole = FlagPole(hoist: MyFlags.self)","","let snapshot = flagPole.emptySnapshot()"]},{"anchor":"Full-snapshots","level":3,"type":"heading","text":"Full snapshots"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When taking a full snapshot, the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole"},{"type":"text","text":" will walk the flag hierarchy and copy the current value of every flag into the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/Snapshot"},{"type":"text","text":", so the internal dictionary will contain every flag key => value currently known."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Full snapshots are used by the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole"},{"type":"text","text":"’s "},{"type":"codeVoice","code":"Publisher"},{"type":"text","text":" when emitting changes."}]},{"type":"codeListing","syntax":"swift","code":["let flagPole = FlagPole(hoist: MyFlags.self)","","let snapshot = flagPole.snapshot()"]},{"anchor":"Full-snapshots-of-a-specific-FlagValueSource","level":3,"type":"heading","text":"Full snapshots of a specific FlagValueSource"},{"type":"paragraph","inlineContent":[{"type":"text","text":"You can also take a snapshot of the current state of a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagValueSource"},{"type":"text","text":". This is a great way to export flag values out of a source and into another. In fact the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole\/copyFlagValues(from:to:)"},{"type":"text","text":" method uses this to copy flag values from one "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagValueSource"},{"type":"text","text":" to another."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Your "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagValueSource"},{"type":"text","text":" doesn’t even need to be a part of the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/Sources"},{"type":"text","text":"."}]},{"type":"codeListing","syntax":"swift","code":["let flagPole = FlagPole(hoist: MyFlags.self)","let source = UserDefaults.standard","","let snapshot = flagPole.snapshot(of: source)        \/\/ contains all the flags that were set in UserDefaults.standard"]}]}],"schemaVersion":{"major":0,"minor":1,"patch":0},"sections":[],"variants":[{"paths":["\/documentation\/vexil\/snapshots"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/Vexil\/documentation\/Vexil\/Snapshots","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"A tour of Snapshots, which are one of the most versatile features of Vexil."}],"kind":"article","metadata":{"roleHeading":"Article","title":"Snapshots","role":"article","modules":[{"name":"Vexil"}]},"hierarchy":{"paths":[["doc:\/\/Vexil\/documentation\/Vexil"]]},"seeAlsoSections":[{"title":"Snapshots","identifiers":["doc:\/\/Vexil\/documentation\/Vexil\/Snapshot","doc:\/\/Vexil\/documentation\/Vexil\/MutableFlagGroup"],"generated":true}],"references":{"doc://Vexil/documentation/Vexil/FlagValueSource":{"role":"symbol","title":"FlagValueSource","fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"kind":"identifier","text":"FlagValueSource"}],"abstract":[{"type":"text","text":"A simple protocol that describes a source of "},{"type":"codeVoice","code":"FlagValue"},{"type":"text","text":"s"}],"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagValueSource","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"FlagValueSource"}],"url":"\/documentation\/vexil\/flagvaluesource"},"doc://Vexil/documentation/Vexil/FlagPole/copyFlagValues(from:to:)":{"role":"symbol","title":"copyFlagValues(from:to:)","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"copyFlagValues"},{"kind":"text","text":"("},{"kind":"externalParam","text":"from"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"FlagValueSource","preciseIdentifier":"s:5Vexil15FlagValueSourceP"},{"kind":"text","text":"?, "},{"kind":"externalParam","text":"to"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"FlagValueSource","preciseIdentifier":"s:5Vexil15FlagValueSourceP"},{"kind":"text","text":") "},{"kind":"keyword","text":"throws"}],"abstract":[{"type":"text","text":"Copies the flag values from one "},{"type":"codeVoice","code":"FlagValueSource"},{"type":"text","text":" to another."}],"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole\/copyFlagValues(from:to:)","kind":"symbol","type":"topic","url":"\/documentation\/vexil\/flagpole\/copyflagvalues(from:to:)"},"doc://Vexil/documentation/Vexil/Sources":{"role":"article","title":"Flag Hierarchy","abstract":[{"type":"text","text":"The Vexil FlagPole supports multiple backend flag sources. This guide walks through the built-in sources, how a FlagPole determines the source hierarchy and how to manipulate it."}],"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/Sources","kind":"article","type":"topic","url":"\/documentation\/vexil\/sources"},"doc://Vexil/documentation/Vexil/FlagPublishing":{"role":"article","title":"Flag Publishing","abstract":[{"type":"text","text":"Vexil supports real-time updates when flag values change through the use of Combine."}],"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPublishing","kind":"article","type":"topic","url":"\/documentation\/vexil\/flagpublishing"},"doc://Vexil/documentation/Vexil/FlagPole":{"role":"symbol","title":"FlagPole","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"FlagPole"}],"abstract":[{"type":"text","text":"A "},{"type":"codeVoice","code":"FlagPole"},{"type":"text","text":" hoists a group of feature flags \/ feature toggles."}],"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/FlagPole","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"FlagPole"}],"url":"\/documentation\/vexil\/flagpole"},"doc://Vexil/documentation/Vexil/Snapshot":{"role":"symbol","title":"Snapshot","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"Snapshot"}],"abstract":[{"type":"text","text":"A "},{"type":"codeVoice","code":"Snapshot"},{"type":"text","text":" serves multiple purposes in Vexil. It is a point-in-time container of flag values, and is also"},{"type":"text","text":" "},{"type":"text","text":"mutable and can be applied \/ saved to a "},{"type":"codeVoice","code":"FlagValueSource"},{"type":"text","text":"."}],"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/Snapshot","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"Snapshot"}],"url":"\/documentation\/vexil\/snapshot"},"doc://Vexil/documentation/Vexil":{"role":"collection","title":"Vexil","abstract":[{"type":"text","text":"Vexil (named for Vexillology) is a Swift package for managing feature flags (also called feature toggles) in a flexible, multi-provider way."}],"identifier":"doc:\/\/Vexil\/documentation\/Vexil","kind":"symbol","type":"topic","url":"\/documentation\/vexil"},"doc://Vexil/documentation/Vexil/Flag/wrappedValue":{"role":"symbol","title":"wrappedValue","fragments":[{"kind":"keyword","text":"var"},{"kind":"text","text":" "},{"kind":"identifier","text":"wrappedValue"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"Value"}],"abstract":[{"type":"text","text":"The "},{"type":"codeVoice","code":"Flag"},{"type":"text","text":" value. This is a calculated property based on the "},{"type":"codeVoice","code":"FlagPole"},{"type":"text","text":"s sources."}],"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/Flag\/wrappedValue","kind":"symbol","type":"topic","url":"\/documentation\/vexil\/flag\/wrappedvalue"},"doc://Vexil/documentation/Vexil/MutableFlagGroup":{"role":"symbol","title":"MutableFlagGroup","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"MutableFlagGroup"}],"abstract":[{"type":"text","text":"A "},{"type":"codeVoice","code":"MutableFlagGroup"},{"type":"text","text":" is a wrapper type that provides a “setter” for each contained "},{"type":"codeVoice","code":"Flag"},{"type":"text","text":"."}],"identifier":"doc:\/\/Vexil\/documentation\/Vexil\/MutableFlagGroup","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"MutableFlagGroup"}],"url":"\/documentation\/vexil\/mutableflaggroup"}}}